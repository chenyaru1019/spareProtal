// 提交前事件
$.MvcSheet.SubmitAction.OnActionPreDo = function () {
    //// 申请修改合同号状态
    //var UpdateNoFlg = $.MvcSheetUI.GetControlValue("UpdateNoFlg");
    //// 审签合同状态
    //var ApproveFlg = $.MvcSheetUI.GetControlValue("ApproveFlg");
    //// 执行合同状态
    //var OperateFlg = $.MvcSheetUI.GetControlValue("OperateFlg");
    //// 合同完成状态
    //var CompleteFlg = $.MvcSheetUI.GetControlValue("CompleteFlg");
    var ContractNo = $.MvcSheetUI.GetControlValue("ContractNo");
    // 当前节点是合同创建节点
    if ($.MvcSheetUI.SheetInfo.ActivityCode == "ActivityCreate") {
        // AB角check
        var PostA = $.MvcSheetUI.GetControlValue("PostA");
        var PostB = $.MvcSheetUI.GetControlValue("PostB");
        if ($.MvcSheetUI.SheetInfo.Originator != PostA && $.MvcSheetUI.SheetInfo.Originator != PostB) {
            alert("当前用户必须是A角或B角之一！");
            return false;
        }
        var el = $("table[data-datafield='UpdateNoTbl']").find("[data-datafield='UpdateNoTbl.Status']");
        var txt = el.length > 1 ? el[1].value : "";
        // 审批完了后才可以修改合同金额以下的数据
        if (txt == "审批中") {
            alert("当前正在申请修改合同号，不能提交到下一步！");
            return false;
        }
        //if (UpdateNoFlg == '2') {
        //    alert("当前正在申请修改合同号，不能提交到下一步！");
        //    return false;
        //}
    } else if ($.MvcSheetUI.SheetInfo.ActivityCode == "ActivityApprove") {
        var dtl = $.MvcSheetUI.GetElement("ContractApproveTbl").SheetGridView();
        if (dtl.RowCount <= 0) {
            alert("当前还没有审签过，不能提交到下一步！");
            return false;
        }
    } else if ($.MvcSheetUI.SheetInfo.ActivityCode == "ActivityOperate") {
        // 1、未发起请款、到款、付款、结算流程
        var qkCnt = 0;
        var dkCnt = 0;
        var fkCnt = 0;
        var jsCnt = 0;
        var errstr = "";
        var errgdstr = "";
        $.ajax({
            type: "POST",    //页面请求的类型
            url: "ContractHandler.ashx?Command=getCountByConId",   //处理页的相对地址
            data: {
                ContractNo: ContractNo,
            },
            async: false,
            success: function (ret) {    //这是处理后执行的函数，msg是处理页返回的数据
                if (ret.qkCnt == 0) {
                    errstr += "请款、";
                }
                if (ret.dkCnt == 0) {
                    errstr += "到款、";
                }
                if (ret.fkCnt == 0) {
                    errstr += "付款、";
                }
                if (ret.jsCnt == 0) {
                    errstr += "结算";
                }
                if (ret.gdCnt == 0) {
                    errgdstr = "合同正本签字版未完成归档";
                }
            }
        });
        if (errstr != "") {
            alert("未发起" + errstr+"流程!");
            return false;
        }  else {
            // 2、XX流程未完成
            $.ajax({
                type: "POST",    //页面请求的类型
                url: "ContractHandler.ashx?Command=getApplyingCountOfOper",   //处理页的相对地址
                data: {
                    ContractNo: ContractNo,
                },
                async: false,
                success: function (ret) {    //这是处理后执行的函数，msg是处理页返回的数据
                    if (ret.qkCnt > 0) {
                        errstr += "请款流程未完成。\n";
                    }
                    if (ret.dkCnt > 0) {
                        errstr += "到款流程未完成。\n";
                    }
                    if (ret.fkCnt > 0) {
                        errstr += "付款流程未完成。\n";
                    }
                    if (ret.jsCnt > 0) {
                        errstr += "结算流程未完成。\n";
                    }
                    if (ret.psCnt > 0) {
                        errstr += "信用证流程未完成。\n";
                    }
                    if (ret.ilsCnt > 0) {
                        errstr += "进口许可证流程未完成。\n";
                    }
                    if (ret.dhCnt > 0) {
                        errstr += "到货流程未完成。\n";
                    }
                    if (ret.bgCnt > 0) {
                        errstr += "合同变更流程未完成。\n";
                    }
                    if (ret.bhCnt > 0) {
                        errstr += "保函流程未完成。\n";
                    }
                    if (ret.gdCnt > 0 || ret.gdcCnt > 0 ) {
                        errstr += "合同文件流程未完成。\n";
                    }
                }
            });
            if (errstr != "") {
                alert(errstr);
                return false;
            } else if (errgdstr != "") {
                // 3、合同正本签字版未完成归档
                alert(errgdstr);
                return false;
            } else {
                // 4、合同人民币未能达到支付比例（100.00%）
                var FKPercentRMB = $.MvcSheetUI.GetControlValue("FKPercentRMB");
                if (FKPercentRMB != "100.00%") {
                    alert("合同人民币未能达到支付比例（100.00%）");
                    return false;
                }
            }
        }
    }
}
////初始化
//$.MvcSheet.PreInit = function () {


//}
//数据加载后
$.MvcSheet.Loaded = function () {
    $.MvcSheetUI.SetControlValue("ToApproveSubFlg", "");
    $.MvcSheetUI.SetControlValue("ToFileGDFlg", "");
    $.MvcSheetUI.SetControlValue("ToChangeGDFlg", "");
    $("input[data-datafield='AgencyComment']").attr("disabled", "disabled");
    $("input[data-datafield='ContractFileNameSignVer']").attr("disabled", "disabled");
    $("input[data-datafield='AgencyFileNameSignVer']").attr("disabled", "disabled");
    $("input[data-datafield='ContractChangeFileNameSignVer']").attr("disabled", "disabled");
    $("input[data-datafield='AgencyChangeFileNameSignVer']").attr("disabled", "disabled");
   console.log($.MvcSheetUI.SheetInfo.ActivityCode);
   if ($.MvcSheetUI.GetControlValue('IsComplete') == "True") {
       // 流程图
       $("#apDiv1 input").removeClass("bt_project2").removeClass("bt_project3").addClass("bt_project1");
       $("#apDiv22 input").removeClass("bt_project2").removeClass("bt_project3").addClass("bt_project1");
       $("#apDiv3 input").removeClass("bt_project2").removeClass("bt_project3").addClass("bt_project1");
       $("#apDiv4 input").removeClass("bt_project2").removeClass("bt_project3").addClass("bt_project1");
       $('.operateChild').removeClass("bt_progress_child_long2").addClass("bt_progress_child_long1");
       $('.operateChild').attr("disabled", "disabled");
        // 生成合同号、申请修改合同号按钮 不显示
        $("#generateContractNoId").hide();
        $("#ApplyContractNoId").hide();
        // 信用证
        $("#ApprovePaymentId").hide();
        // 进口许可证
        $("#ApproveImportLicenseId").hide();
        // 到货
        $("#ApproveDHId").hide();
        // 合同变更
        $("#ApproveBGId").hide();
        // 合同归档
        $("#GDContractFileId").hide();
        $("#GDChangeContractFileId").hide();
        // 保函
        $("#ApproveBHId").hide();
        // 资金计划
        $("#EditZJPlanId").hide();
        // 请款
        $("#ApproveQKId").hide();
        // 到款
        $("#ApproveDKId").hide();
        // 付款
        $("#ApproveFKId").hide();
        // 结算
        $("#ApproveJSId").hide();
        // 支付管理的新增
        $("#xzBtn").hide();
    } else {
        // 当前节点是合同创建节点
        if ($.MvcSheetUI.SheetInfo.ActivityCode == "ActivityCreate") {
            // 申请修改合同号子表 不能编辑
            $("input[data-datafield='UpdateNoTbl.Approver']").attr("disabled", "disabled");
            $("input[data-datafield='UpdateNoTbl.ApproveDate']").attr("disabled", "disabled");
            $("input[data-datafield='UpdateNoTbl.ContractNoNew']").attr("disabled", "disabled");
            $("input[data-datafield='UpdateNoTbl.Status']").attr("disabled", "disabled");
            // 流程图
            $("#apDiv1 input").removeClass("bt_project1").removeClass("bt_project3").addClass("bt_project2");
            $("#apDiv22 input").removeClass("bt_project1").removeClass("bt_project2").addClass("bt_project3");
            $("#apDiv3 input").removeClass("bt_project1").removeClass("bt_project2").addClass("bt_project3");
            $("#apDiv4 input").removeClass("bt_project1").removeClass("bt_project2").addClass("bt_project3");
            $('.operateChild').attr("disabled", "disabled");

            // 审批申请按钮 不显示
            $("#ApplyApproveId").hide();
            // 信用证
            $("#ApprovePaymentId").hide();
            // 进口许可证
            $("#ApproveImportLicenseId").hide();
            // 到货
            $("#ApproveDHId").hide();
            // 合同变更
            $("#ApproveBGId").hide();
            // 合同归档
            $("#GDContractFileId").hide();
            $("#GDChangeContractFileId").hide();
            // 保函
            $("#ApproveBHId").hide();
            // 资金计划
            $("#EditZJPlanId").hide();
            // 请款
            $("#ApproveQKId").hide();
            // 到款
            $("#ApproveDKId").hide();
            // 付款
            $("#ApproveFKId").hide();
            // 结算
            $("#ApproveJSId").hide();

            //$(".bannerTitleCreate").click();
            $(".bannerTitleApprove").click();
            $(".bannerTitleOperate").click();

            // 审签节点不显示
            $(".ContractContentApprove").hide();
            // 执行节点不显示
            $(".ContractContentOperate").hide();
            // 完成节点不显示
            $(".ContractContentComplete").hide();
        } else if ($.MvcSheetUI.SheetInfo.ActivityCode == "ActivityApprove") {
            // 审签子表不能编辑
            $("input[data-datafield='ContractApproveTbl.Approver']").attr("disabled", "disabled");
            $("input[data-datafield='ContractApproveTbl.ApproveDate']").attr("disabled", "disabled");
            $("input[data-datafield='ContractApproveTbl.Status']").attr("disabled", "disabled");
            $("input[data-datafield='ContractApproveTbl.Operate']").attr("disabled", "disabled");
            // 流程图
            $("#apDiv1 input").removeClass("bt_project2").removeClass("bt_project3").addClass("bt_project1");
            $("#apDiv22 input").removeClass("bt_project1").removeClass("bt_project3").addClass("bt_project2");
            $("#apDiv3 input").removeClass("bt_project1").removeClass("bt_project2").addClass("bt_project3");
            $("#apDiv4 input").removeClass("bt_project1").removeClass("bt_project2").addClass("bt_project3");
            $('.operateChild').attr("disabled", "disabled");
            // 生成合同号、申请修改合同号按钮 不显示
            $("#generateContractNoId").hide();
            $("#ApplyContractNoId").hide();
            // 信用证
            $("#ApprovePaymentId").hide();
            // 进口许可证
            $("#ApproveImportLicenseId").hide();
            // 到货
            $("#ApproveDHId").hide();
            // 合同变更
            $("#ApproveBGId").hide();
            // 合同归档
            $("#GDContractFileId").hide();
            $("#GDChangeContractFileId").hide();
            // 保函
            $("#ApproveBHId").hide();
            // 资金计划
            $("#EditZJPlanId").hide();
            // 请款
            $("#ApproveQKId").hide();
            // 到款
            $("#ApproveDKId").hide();
            // 付款
            $("#ApproveFKId").hide();
            // 结算
            $("#ApproveJSId").hide();
            var el = $("table[data-datafield='ContractApproveTbl']").find("[data-datafield='ContractApproveTbl.Status']");
            var txt = el.length > 1 ? el[1].value : "";
            // 审批完了后才可以修改合同金额以下的数据
            if (txt != "审批完了") {
                // 合同金额
                $("input[data-datafield='ContractTotalPrice']").attr("disabled", "disabled");
                // 代理协议签约日期
                $("input[data-datafield='AgencySignDate']").attr("disabled", "disabled");
                // 签约日期
                $("input[data-datafield='SignDate']").attr("disabled", "disabled");
                // 合同到货期
                $("[data-datafield='ContractDHDate']").attr("disabled", "disabled");
                // 代理费费率／金额
                $("[data-datafield='AgencyComputerType']").attr("disabled", "disabled");
                // 支付条件
                $("[data-datafield='PayCondition']").attr("disabled", "disabled");
                // 总金额
                $("input[data-datafield='JKTotalAmount']").attr("disabled", "disabled");
                // 币种
                $("[data-datafield='Currency']").attr("disabled", "disabled");
                // 签约日汇率
                $("input[data-datafield='SignDayExchangeRate']").attr("disabled", "disabled");
                // 签约日汇率截屏文件
                $("[data-datafield='SignDayERFile']").find("div").attr("disabled", "disabled");
                $("[data-datafield='SignDayERFile']").find("table tr").each(function () {
                    $(this).find("a.fa-minus").hide();
                });
            }
            if (txt == '审批中' || txt == '审批完了') {
                // 计价方式
                $("input[data-datafield='ValuationType']").attr("disabled", "disabled");
                $("input[data-datafield='Agio']").attr("disabled", "disabled");
                // 到货日期
                $("input[data-datafield='DHDate']").attr("disabled", "disabled");
                // 代理协议类型
                $("select[data-datafield='AgencyType']").attr("disabled", "disabled");
                // 代理协议选择
                $("input[data-datafield='AgencySelect']").attr("disabled", "disabled");
                $("input[data-datafield='AgencySelect']").next().next().hide();
                // 代理协议文件
                $("[data-datafield='AgencyFile']").find("div").attr("disabled", "disabled");
                $("[data-datafield='AgencyFile']").find("table tr").each(function () {
                    $(this).find("a.fa-minus").hide();
                });
                // 协议后审说明
                $("[data-datafield='AgencyAfterRemark']").attr("disabled", "disabled");
                // 合同文本
                $("[data-datafield='ContractFile']").find("div").attr("disabled", "disabled");
                $("[data-datafield='ContractFile']").find("table tr").each(function () {
                    $(this).find("a.fa-minus").hide();
                });
                // 合同谈判小结
                $("[data-datafield='TalkFile']").find("div").attr("disabled", "disabled");
                $("[data-datafield='TalkFile']").find("table tr").each(function () {
                    $(this).find("a.fa-minus").hide();
                });
            }
            // 对应人民币总金额
            $("[data-datafield='RMBTotalAmount']").attr("disabled", "disabled");

            $(".bannerTitleCreate").click();
            //(".bannerTitleApprove").click();
            $(".bannerTitleOperate").click();

            // 执行节点不显示
            $(".ContractContentOperate").hide();
            // 完成节点不显示
            $(".ContractContentComplete").hide();
        } else if ($.MvcSheetUI.SheetInfo.ActivityCode == "ActivityOperate") {
            var ContractNo = $.MvcSheetUI.GetControlValue("ContractNo");
            // 根据合同号码获取对应合同相关数据
            $.ajax({
                type: "POST",    //页面请求的类型
                url: "ContractHandler.ashx?Command=getDataOfOper",   //处理页的相对地址
                data: {
                    ContractNo: ContractNo,
                },
                async: false,
                success: function (ret) {    //这是处理后执行的函数，msg是处理页返回的数据
                    var LJQKAmountRMB = (ret.LJQKAmountRMB == undefined || ret.LJQKAmountRMB == "") ? "0" : ret.LJQKAmountRMB;
                    $.MvcSheetUI.SetControlValue("LJQKAmountRMB", parseFloat(LJQKAmountRMB).toFixed(2));
                    var LJQKAmountWB = (ret.LJQKAmountWB == undefined || ret.LJQKAmountWB == "") ? "0" : ret.LJQKAmountWB;
                    $.MvcSheetUI.SetControlValue("LJQKAmountWB", parseFloat(LJQKAmountWB).toFixed(2));
                    var LJDKAmountRMB = (ret.LJDKAmountRMB == undefined || ret.LJDKAmountRMB == "") ? "0" : ret.LJDKAmountRMB;
                    $.MvcSheetUI.SetControlValue("LJDKAmountRMB", parseFloat(LJDKAmountRMB).toFixed(2));
                    var LJDKAmountWB = (ret.LJDKAmountWB == undefined || ret.LJDKAmountWB == "") ? "0" : ret.LJDKAmountWB;
                    $.MvcSheetUI.SetControlValue("LJDKAmountWB", parseFloat(LJDKAmountWB).toFixed(2));
                    var LJFKAmountRMB = (ret.LJFKAmountRMB == undefined || ret.LJFKAmountRMB == "") ? "0" : ret.LJFKAmountRMB;
                    $.MvcSheetUI.SetControlValue("LJFKAmountRMB", parseFloat(LJFKAmountRMB).toFixed(2));
                    var LJFKAmountWB = (ret.LJFKAmountWB == undefined || ret.LJFKAmountWB == "") ? "0" : ret.LJFKAmountWB;
                    $.MvcSheetUI.SetControlValue("LJFKAmountWB", parseFloat(LJFKAmountWB).toFixed(2));
                    $.MvcSheetUI.SetControlValue("FKPercentRMB", parseFloat(ret.FKPercentRMB).toFixed(2) + "%");
                    $.MvcSheetUI.SetControlValue("FKPercentWB", parseFloat(ret.FKPercentWB).toFixed(2) + "%");
                    var LJQKFYAmountRMB = (ret.LJQKFYAmountRMB == undefined || ret.LJQKFYAmountRMB == "") ? "0" : ret.LJQKFYAmountRMB;
                    $.MvcSheetUI.SetControlValue("LJQKFYAmountRMB", parseFloat(LJQKFYAmountRMB).toFixed(2));
                    var LJQKFYAmountWB = (ret.LJQKFYAmountWB == undefined || ret.LJQKFYAmountWB == "") ? "0" : ret.LJQKFYAmountWB;
                    $.MvcSheetUI.SetControlValue("LJQKFYAmountWB", parseFloat(LJQKFYAmountWB).toFixed(2));
                    var LJDKFYAmountRMB = (ret.LJDKFYAmountRMB == undefined || ret.LJDKFYAmountRMB == "") ? "0" : ret.LJDKFYAmountRMB;
                    $.MvcSheetUI.SetControlValue("LJDKFYAmountRMB", parseFloat(LJDKFYAmountRMB).toFixed(2));
                    var LJDKFYAmountWB = (ret.LJDKFYAmountWB == undefined || ret.LJDKFYAmountWB == "") ? "0" : ret.LJDKFYAmountWB;
                    $.MvcSheetUI.SetControlValue("LJDKFYAmountWB", parseFloat(LJDKFYAmountWB).toFixed(2));
                    var LJFKFYAmountRMB = (ret.LJFKFYAmountRMB == undefined || ret.LJFKFYAmountRMB == "") ? "0" : ret.LJFKFYAmountRMB;
                    $.MvcSheetUI.SetControlValue("LJFKFYAmountRMB", parseFloat(LJFKFYAmountRMB).toFixed(2));
                    var LJFKFYAmountWB = (ret.LJFKFYAmountWB == undefined || ret.LJFKFYAmountWB == "") ? "0" : ret.LJFKFYAmountWB;
                    $.MvcSheetUI.SetControlValue("LJFKFYAmountWB", parseFloat(LJFKFYAmountWB).toFixed(2));
                    $.MvcSheetUI.SetControlValue("CurrencyRMB", "人民币");
                    $.MvcSheetUI.SetControlValue("CurrencyWB", ret.CurrencyName);
                }
            });
            $(".CurrencyRMB").text($.MvcSheetUI.GetControlValue("CurrencyRMB"));
            $(".CurrencyWB").text($.MvcSheetUI.GetControlValue("CurrencyWB"));

            // 审批申请按钮 不显示
            $("#ApplyApproveId").hide();
            // 生成合同号、申请修改合同号按钮 不显示
            $("#generateContractNoId").hide();
            $("#ApplyContractNoId").hide();
            // 流程图
            $("#apDiv1 input").removeClass("bt_project2").removeClass("bt_project3").addClass("bt_project1");
            $("#apDiv22 input").removeClass("bt_project2").removeClass("bt_project3").addClass("bt_project1");
            $("#apDiv3 input").removeClass("bt_project1").removeClass("bt_project3").addClass("bt_project2");
            $("#apDiv4 input").removeClass("bt_project1").removeClass("bt_project2").addClass("bt_project3");
            // 信用证记录子表不能编辑
            $("input[data-datafield='PaymentTbl.Bank']").attr("disabled", "disabled");
            $("input[data-datafield='PaymentTbl.TotalAmount']").attr("disabled", "disabled");
            $("input[data-datafield='PaymentTbl.Status']").attr("disabled", "disabled");
            $("input[data-datafield='PaymentTbl.UpdatePayment']").attr("disabled", "disabled");
            $("input[data-datafield='PaymentTbl.TheNo']").attr("disabled", "disabled");

            $(".bannerTitleCreate").click();
            $(".bannerTitleApprove").click();
            //$(".bannerTitleOperate").click();

            // 资金计划
            //$("#EditZJPlanId").hide();
            // 请款
            //$("#ApproveQKId").hide();
            // 到款
            // 申请到款按钮显示否
            $.ajax({
                type: "POST",    //页面请求的类型
                url: "ContractHandler.ashx?Command=getDKTbl",   //处理页的相对地址
                data: {
                    ContractNo: ContractNo,
                },
                async: false,
                success: function (ret) {    //这是处理后执行的函数，msg是处理页返回的数据
                    if (ret.length > 0) {
                        $("#ApproveDKId").show();
                    } else {
                        $("#ApproveDKId").hide();
                    }
                }
            });
            // 付款
            // $("#ApproveFKId").hide();
            // 结算
            // $("#ApproveJSId").hide();

            // 完成节点不显示
            $(".ContractContentComplete").hide();

        }
    }
    
    

    // 累计金额只读
    $("input[data-datafield='LJQKAmountRMB']").attr("disabled", "disabled");
    $("input[data-datafield='LJQKAmountWB']").attr("disabled", "disabled");
    $("input[data-datafield='LJDKAmountRMB']").attr("disabled", "disabled");
    $("input[data-datafield='LJDKAmountWB']").attr("disabled", "disabled");
    $("input[data-datafield='LJFKAmountRMB']").attr("disabled", "disabled");
    $("input[data-datafield='LJFKAmountWB']").attr("disabled", "disabled");
    $("input[data-datafield='FKPercentRMB']").attr("disabled", "disabled");
    $("input[data-datafield='FKPercentWB']").attr("disabled", "disabled");
    $("input[data-datafield='LJQKFYAmountRMB']").attr("disabled", "disabled");
    $("input[data-datafield='LJQKFYAmountWB']").attr("disabled", "disabled");
    $("input[data-datafield='LJDKFYAmountRMB']").attr("disabled", "disabled");
    $("input[data-datafield='LJDKFYAmountWB']").attr("disabled", "disabled");
    $("input[data-datafield='LJFKFYAmountRMB']").attr("disabled", "disabled");
    $("input[data-datafield='LJFKFYAmountWB']").attr("disabled", "disabled");

    // 支付管理

    // 获取支付管理相关数据
    $.ajax({
        type: "POST",    //页面请求的类型
        url: "ContractHandler.ashx?Command=getPayManager",   //处理页的相对地址
        data: {
            ContractNo: $.MvcSheetUI.GetControlValue("ContractNo"),
        },
        async: false,
        success: function (ret) {    //这是处理后执行的函数，msg是处理页返回的数据
            for (var i = 0; i < ret.length; i++) {
                var obj = {};
                obj.zjjh = ret[i].ZJJH_Values;
                obj.zjjh_keys = ret[i].ZJJH_Keys;
                obj.qk = ret[i].QK_Values;
                obj.qk_keys = ret[i].QK_Keys;
                obj.dk = ret[i].DK_Values;
                obj.dk_keys = ret[i].DK_Keys;
                obj.fk = ret[i].FK_Values;
                obj.fk_keys = ret[i].FK_Keys;
                obj.djsje = ret[i].JSAmount;
                obj.id = ret[i].id;
                // 往bootstrapTable添加数据
                $("#tableL02").bootstrapTable('insertRow', { index: i, row: obj });
                //tableData.push(obj);
            }

        }
    });
    
    //$('#tableL02').bootstrapTable({
    //    height: 200,
    //    //        showRefresh: true,
    //    toolbar: '#toolbar',
    //    //模拟数据
    //    columns: [{
    //        align: 'center',
    //        valign: 'middle',
    //        field: 'zjjh',
    //        title: '资金计划'
    //    }, {
    //        align: 'center',
    //        valign: 'middle',
    //        field: 'qk',
    //        title: '请款'
    //    }, {
    //        align: 'center',
    //        valign: 'middle',
    //        field: 'dk',
    //        title: '到款'
    //    }, {
    //        align: 'center',
    //        valign: 'middle',
    //        field: 'fk',
    //        title: '付款'
    //    }, {
    //        align: 'center',
    //        valign: 'middle',
    //        field: 'djsje',
    //        title: '待结算金额'
    //    }, {
    //        align: 'center',
    //        valign: 'middle',
    //        field: 'bj',
    //        title: '',
    //        events: operateEvents,
    //        formatter: addBtn
    //    }],
    //    data: tableData
    //});
    // 信用证子表的改证显示判断
    var rowp = 0;
    $("[data-datafield='PaymentTbl']").find("tr.rows").each(function () {
        rowp++;
        var Status = $.MvcSheetUI.GetControlValue("PaymentTbl.Status", rowp);
        var changePaymentFlg = $.MvcSheetUI.GetControlValue("PaymentTbl.changePaymentFlg", rowp);
        var RejectFlg = $.MvcSheetUI.GetControlValue("PaymentTbl.RejectFlg", rowp);
        if (Status == "已开证") {
            $(this).find("td[data-field='PaymentTbl.UpdatePayment'] a").show();
            if (changePaymentFlg == "2") {
                $(this).find("td[data-field='PaymentTbl.UpdatePayment'] a").hide();
                $(this).find("td[data-field='PaymentTbl.UpdatePayment']").text("改证中");
            } else if (changePaymentFlg == "4") {
                $(this).find("td[data-field='PaymentTbl.UpdatePayment'] a").hide();
                $(this).find("td[data-field='PaymentTbl.UpdatePayment']").text("已改证");
            }
        } else {
            $(this).find("td[data-field='PaymentTbl.UpdatePayment'] a").hide();
        }
        if (RejectFlg == "1") {
            $(this).find("td[data-field='PaymentTbl.Operate'] a.updatePayment").show();
        } else {
            $(this).find("td[data-field='PaymentTbl.Operate'] a.updatePayment").hide();
        }
        
    });

    // 进口许可证子表的显示判断
    var rowp = 0;
    $("[data-datafield='ImportLicenceTbl']").find("tr.rows").each(function () {
        rowp++;
        var Status = $.MvcSheetUI.GetControlValue("ImportLicenceTbl.Status", rowp);
        var RejectFlg = $.MvcSheetUI.GetControlValue("ImportLicenceTbl.RejectFlg", rowp);
        var CancelFlg = $.MvcSheetUI.GetControlValue("ImportLicenceTbl.CancelFlg", rowp);
        var DisplayName = $.MvcSheetUI.GetControlValue("ImportLicenceTbl.DisplayName", rowp);

        if (Status == "4") {
            if (RejectFlg == "1" || DisplayName == "草稿") {
                $(this).find("td[data-field='ImportLicenceTbl.Operate'] a.updateImportLicence").show();
            } else {
                $(this).find("td[data-field='ImportLicenceTbl.Operate'] a.updateImportLicence").hide();
            }
            if (CancelFlg == "1") {
                $(this).find("td[data-field='ImportLicenceTbl.Operate'] a.cancelImportLicence").hide();
                $(this).find("td[data-field='ImportLicenceTbl.Operate'] a.undocancelImportLicence").show();
            } else {
                $(this).find("td[data-field='ImportLicenceTbl.Operate'] a.cancelImportLicence").show();
                $(this).find("td[data-field='ImportLicenceTbl.Operate'] a.undocancelImportLicence").hide();
            }
        } else {
            if (RejectFlg == "1" || DisplayName == "草稿") {
                $(this).find("td[data-field='ImportLicenceTbl.Operate'] a.updateImportLicence").show();
            } else {
                $(this).find("td[data-field='ImportLicenceTbl.Operate'] a.updateImportLicence").hide();
            }
            $(this).find("td[data-field='ImportLicenceTbl.Operate'] a.cancelImportLicence").hide();
            $(this).find("td[data-field='ImportLicenceTbl.Operate'] a.undocancelImportLicence").hide();
        }         
        
    });
    // 请款子表的合并单元格操作
    var dtl = $.MvcSheetUI.GetElement("QKMainTbl").SheetGridView();
    var len = dtl.RowCount;
    var QKSeq = "";
    if (len > 0) {
        for (var i = 0; i < len; i++) {

            if (QKSeq == "" || QKSeq != $.MvcSheetUI.GetControlValue("QKMainTbl.QKSeq", i + 1)) {
                QKSeq = $.MvcSheetUI.GetControlValue("QKMainTbl.QKSeq", i + 1);
                var SeqCnt = $.MvcSheetUI.GetControlValue("QKMainTbl.SeqCnt", i + 1);
                var Status = $.MvcSheetUI.GetControlValue("QKMainTbl.Status", i + 1);
                var k = 0;
                $("[data-datafield='QKMainTbl']").find("tr.rows").each(function () {
                    if (k == i) {
                        $(this).find("td[data-field='QKMainTbl.QKSeq']").attr("rowspan", SeqCnt);
                        $(this).find("td[data-field='QKMainTbl.QKTotalAmount']").attr("rowspan", SeqCnt);
                        $(this).find("td[data-field='QKMainTbl.QKTarget']").attr("rowspan", SeqCnt);
                        $(this).find("td[data-field='QKMainTbl.Status']").attr("rowspan", SeqCnt);
                        $(this).find("td[data-field='QKMainTbl.Operate']").attr("rowspan", SeqCnt);
                        if (Status != "审批完成") {
                            $(this).find("td[data-field='QKMainTbl.Operate'] a.updateQK").show();
                        } else {
                            $(this).find("td[data-field='QKMainTbl.Operate'] a.updateQK").hide();
                        }
                    }
                    k++;
                });
            } else {
                QKSeq = $.MvcSheetUI.GetControlValue("QKMainTbl.QKSeq", i + 1);
                var k = 0;
                $("[data-datafield='QKMainTbl']").find("tr.rows").each(function () {
                    if (k == i) {
                        $(this).find("td[data-field='QKMainTbl.QKSeq']").remove();
                        $(this).find("td[data-field='QKMainTbl.QKTotalAmount']").remove();
                        $(this).find("td[data-field='QKMainTbl.QKTarget']").remove();
                        $(this).find("td[data-field='QKMainTbl.Status']").remove();
                        $(this).find("td[data-field='QKMainTbl.Operate']").remove();
                    }
                    k++;
                });
            }
        }
    }

    // 到款状态子表的显示判断
    var rowp = 0;
    var dtl = $.MvcSheetUI.GetElement("DKStatusTbl").SheetGridView();
    var len = dtl.RowCount;
    var QKSeq = "";
    if (len > 0) {
        for (var i = 0; i < len; i++) {

            if (QKSeq == "" || QKSeq != $.MvcSheetUI.GetControlValue("DKStatusTbl.QKSeq", i + 1)) {
                QKSeq = $.MvcSheetUI.GetControlValue("DKStatusTbl.QKSeq", i + 1);
                var SeqCnt = $.MvcSheetUI.GetControlValue("DKStatusTbl.SeqCnt", i + 1);
                var k = 0;
                $("[data-datafield='DKStatusTbl']").find("tr.rows").each(function () {
                    if (k == i) {
                        $(this).find("td[data-field='DKStatusTbl.QKSeq']").attr("rowspan", SeqCnt);
                        $(this).find("td[data-field='DKStatusTbl.QKConvertAmount']").attr("rowspan", SeqCnt);
                        $(this).find("td[data-field='DKStatusTbl.QKTarget']").attr("rowspan", SeqCnt);
                    }
                    k++;
                });
            } else {
                QKSeq = $.MvcSheetUI.GetControlValue("DKStatusTbl.QKSeq", i + 1);
                var k = 0;
                $("[data-datafield='DKStatusTbl']").find("tr.rows").each(function () {
                    if (k == i) {
                        $(this).find("td[data-field='DKStatusTbl.QKSeq']").remove();
                        $(this).find("td[data-field='DKStatusTbl.QKConvertAmount']").remove();
                        $(this).find("td[data-field='DKStatusTbl.QKTarget']").remove();
                    }
                    k++;
                });
            }
        }
    }

    // 到款记录子表的显示判断
    var rowp = 0;
    $("[data-datafield='DKRecordTbl']").find("tr.rows").each(function () {
        rowp++;
        var Status = $.MvcSheetUI.GetControlValue("DKRecordTbl.Status", rowp);
        var RejectFlg = $.MvcSheetUI.GetControlValue("DKRecordTbl.RejectFlg", rowp);
        var DisplayName = $.MvcSheetUI.GetControlValue("DKRecordTbl.DisplayName", rowp);

        if (DisplayName == "驳回") {
            $(this).find("td[data-field='DKRecordTbl.Operate'] a.updateDK").show();
        } else {
            $(this).find("td[data-field='DKRecordTbl.Operate'] a.updateDK").hide();
        }

    });

    // 付款子表的合并单元格操作
    var dtl = $.MvcSheetUI.GetElement("FKRecordTbl").SheetGridView();
    var len = dtl.RowCount;
    var TheNo = "";
    if (len > 0) {
        for (var i = 0; i < len; i++) {

            if (TheNo == "" || TheNo != $.MvcSheetUI.GetControlValue("FKRecordTbl.TheNo", i + 1)) {
                TheNo = $.MvcSheetUI.GetControlValue("FKRecordTbl.TheNo", i + 1);
                var Cnt = $.MvcSheetUI.GetControlValue("FKRecordTbl.Cnt", i + 1);
                var DisplayName = $.MvcSheetUI.GetControlValue("FKRecordTbl.DisplayName", i + 1);
                var k = 0;
                $("[data-datafield='FKRecordTbl']").find("tr.rows").each(function () {
                    if (k == i) {
                        $(this).find("td[data-field='FKRecordTbl.TheNo']").attr("rowspan", Cnt);
                        $(this).find("td[data-field='FKRecordTbl.ConvertAmount']").attr("rowspan", Cnt);
                        $(this).find("td[data-field='FKRecordTbl.FKDate']").attr("rowspan", Cnt);
                        $(this).find("td[data-field='FKRecordTbl.Content']").attr("rowspan", Cnt);
                        $(this).find("td[data-field='FKRecordTbl.PayType']").attr("rowspan", Cnt);
                        $(this).find("td[data-field='FKRecordTbl.Receiver']").attr("rowspan", Cnt);
                        $(this).find("td[data-field='FKRecordTbl.DisplayName']").attr("rowspan", Cnt);
                        $(this).find("td[data-field='FKRecordTbl.Operate']").attr("rowspan", Cnt);
                        if (DisplayName == "驳回") {
                            $(this).find("td[data-field='FKRecordTbl.Operate'] a.updateFK").show();
                        } else {
                            if (DisplayName == "草稿") {
                                $(this).find("td[data-field='FKRecordTbl.Operate'] a.updateFK").show();
                            } else {
                                $(this).find("td[data-field='FKRecordTbl.Operate'] a.updateFK").hide();
                            }
                        }
                    }
                    k++;
                });
            } else {
                TheNo = $.MvcSheetUI.GetControlValue("FKRecordTbl.TheNo", i + 1);
                var k = 0;
                $("[data-datafield='FKRecordTbl']").find("tr.rows").each(function () {
                    if (k == i) {
                        $(this).find("td[data-field='FKRecordTbl.TheNo']").remove();
                        $(this).find("td[data-field='FKRecordTbl.ConvertAmount']").remove();
                        $(this).find("td[data-field='FKRecordTbl.FKDate']").remove();
                        $(this).find("td[data-field='FKRecordTbl.Content']").remove();
                        $(this).find("td[data-field='FKRecordTbl.PayType']").remove();
                        $(this).find("td[data-field='FKRecordTbl.Receiver']").remove();
                        $(this).find("td[data-field='FKRecordTbl.DisplayName']").remove();
                        $(this).find("td[data-field='FKRecordTbl.Operate']").remove();
                    }
                    k++;
                });
            }
        }
    }

    // 拒付付款子表的合并单元格操作
    var dtl = $.MvcSheetUI.GetElement("FKJFRecordTbl").SheetGridView();
    var len = dtl.RowCount;
    var TheNo = "";
    if (len > 0) {
        for (var i = 0; i < len; i++) {

            if (TheNo == "" || TheNo != $.MvcSheetUI.GetControlValue("FKJFRecordTbl.TheNo", i + 1)) {
                TheNo = $.MvcSheetUI.GetControlValue("FKJFRecordTbl.TheNo", i + 1);
                var Cnt = $.MvcSheetUI.GetControlValue("FKJFRecordTbl.Cnt", i + 1);
                var DisplayName = $.MvcSheetUI.GetControlValue("FKJFRecordTbl.DisplayName", i + 1);
                var k = 0;
                $("[data-datafield='FKJFRecordTbl']").find("tr.rows").each(function () {
                    if (k == i) {
                        $(this).find("td[data-field='FKJFRecordTbl.TheNo']").attr("rowspan", Cnt);
                        $(this).find("td[data-field='FKJFRecordTbl.ConvertAmount']").attr("rowspan", Cnt);
                        $(this).find("td[data-field='FKJFRecordTbl.FKDate']").attr("rowspan", Cnt);
                        $(this).find("td[data-field='FKJFRecordTbl.Content']").attr("rowspan", Cnt);
                        $(this).find("td[data-field='FKJFRecordTbl.PayType']").attr("rowspan", Cnt);
                        $(this).find("td[data-field='FKJFRecordTbl.Receiver']").attr("rowspan", Cnt);
                        $(this).find("td[data-field='FKJFRecordTbl.DisplayName']").attr("rowspan", Cnt);
                        $(this).find("td[data-field='FKJFRecordTbl.Operate']").attr("rowspan", Cnt);
                        if (DisplayName == "驳回") {
                            $(this).find("td[data-field='FKJFRecordTbl.Operate'] a.updateFKJF").show();
                        } else {
                            if (DisplayName == "草稿") {
                                $(this).find("td[data-field='FKJFRecordTbl.Operate'] a.updateFKJF").show();
                            } else {
                                $(this).find("td[data-field='FKJFRecordTbl.Operate'] a.updateFKJF").hide();
                            }
                        }
                    }
                    k++;
                });
            } else {
                TheNo = $.MvcSheetUI.GetControlValue("FKJFRecordTbl.TheNo", i + 1);
                var k = 0;
                $("[data-datafield='FKJFRecordTbl']").find("tr.rows").each(function () {
                    if (k == i) {
                        $(this).find("td[data-field='FKJFRecordTbl.TheNo']").remove();
                        $(this).find("td[data-field='FKJFRecordTbl.ConvertAmount']").remove();
                        $(this).find("td[data-field='FKJFRecordTbl.FKDate']").remove();
                        $(this).find("td[data-field='FKJFRecordTbl.Content']").remove();
                        $(this).find("td[data-field='FKJFRecordTbl.PayType']").remove();
                        $(this).find("td[data-field='FKJFRecordTbl.Receiver']").remove();
                        $(this).find("td[data-field='FKJFRecordTbl.DisplayName']").remove();
                        $(this).find("td[data-field='FKJFRecordTbl.Operate']").remove();
                    }
                    k++;
                });
            }
        }
    }

    // 结算中的付款子表的合并单元格操作
    var dtl = $.MvcSheetUI.GetElement("FKRecordTblOfJS").SheetGridView();
    var len = dtl.RowCount;
    var TheNo = "";
    if (len > 0) {
        for (var i = 0; i < len; i++) {

            if (TheNo == "" || TheNo != $.MvcSheetUI.GetControlValue("FKRecordTblOfJS.TheNo", i + 1)) {
                TheNo = $.MvcSheetUI.GetControlValue("FKRecordTblOfJS.TheNo", i + 1);
                var Cnt = $.MvcSheetUI.GetControlValue("FKRecordTblOfJS.Cnt", i + 1);
                var k = 0;
                $("[data-datafield='FKRecordTblOfJS']").find("tr.rows").each(function () {
                    if (k == i) {
                        $(this).find("td[data-field='FKRecordTblOfJS.TheNo']").attr("rowspan", Cnt);
                        $(this).find("td[data-field='FKRecordTblOfJS.ConvertAmount']").attr("rowspan", Cnt);
                        $(this).find("td[data-field='FKRecordTblOfJS.Content']").attr("rowspan", Cnt);
                        $(this).find("td[data-field='FKRecordTblOfJS.Receiver']").attr("rowspan", Cnt);
                        $(this).find("td[data-field='FKRecordTblOfJS.Status']").attr("rowspan", Cnt);
                    }
                    k++;
                });
            } else {
                TheNo = $.MvcSheetUI.GetControlValue("FKRecordTblOfJS.TheNo", i + 1);
                var k = 0;
                $("[data-datafield='FKRecordTblOfJS']").find("tr.rows").each(function () {
                    if (k == i) {
                        $(this).find("td[data-field='FKRecordTblOfJS.TheNo']").remove();
                        $(this).find("td[data-field='FKRecordTblOfJS.ConvertAmount']").remove();
                        $(this).find("td[data-field='FKRecordTblOfJS.Content']").remove();
                        $(this).find("td[data-field='FKRecordTblOfJS.Receiver']").remove();
                        $(this).find("td[data-field='FKRecordTblOfJS.Status']").remove();
                    }
                    k++;
                });
            }
        }
    }

    // 结算记录子表的显示判断
    var rowp = 0;
    $("[data-datafield='JSRecordTbl']").find("tr.rows").each(function () {
        rowp++;
        var Status = $.MvcSheetUI.GetControlValue("JSRecordTbl.Status", rowp);
        var RejectFlg = $.MvcSheetUI.GetControlValue("JSRecordTbl.RejectFlg", rowp);
        var DisplayName = $.MvcSheetUI.GetControlValue("JSRecordTbl.DisplayName", rowp);

        if (DisplayName == "驳回" || DisplayName == "草稿") {
            $(this).find("td[data-field='JSRecordTbl.Operate'] a.updateJS").show();
            $(this).find("td[data-field='JSRecordTbl.Operate'] a.updateJSQK").hide();
            $(this).find("td[data-field='JSRecordTbl.Operate'] a.updateJSFK").hide();
        } else {
            if (DisplayName == "待请款") {
                $(this).find("td[data-field='JSRecordTbl.Operate'] a.updateJS").hide();
                if (Status == "") {
                    $(this).find("td[data-field='JSRecordTbl.Operate'] a.updateJSQK").show();
                } else {
                    $(this).find("td[data-field='JSRecordTbl.Operate'] a.updateJSQK").hide();
                }
                $(this).find("td[data-field='JSRecordTbl.Operate'] a.updateJSFK").hide();
            } else if (DisplayName == "待付款") {
                $(this).find("td[data-field='JSRecordTbl.Operate'] a.updateJS").hide();
                $(this).find("td[data-field='JSRecordTbl.Operate'] a.updateJSQK").hide();
                if (Status == "") {
                    $(this).find("td[data-field='JSRecordTbl.Operate'] a.updateJSFK").show();
                } else {
                    $(this).find("td[data-field='JSRecordTbl.Operate'] a.updateJSFK").hide();
                }
            } else {
                $(this).find("td[data-field='JSRecordTbl.Operate'] a.updateJS").hide();
                $(this).find("td[data-field='JSRecordTbl.Operate'] a.updateJSQK").hide();
                $(this).find("td[data-field='JSRecordTbl.Operate'] a.updateJSFK").hide();
            }
        }

    });
    

    // 到货子表的合并单元格操作
    var dtl_dh = $.MvcSheetUI.GetElement("DHTbl").SheetGridView();
    var len_dh = dtl_dh.RowCount;
    var DHSeq = "";
    if (len_dh > 0) {
        for (var i = 0; i < len_dh; i++) {

            if (DHSeq == "" || DHSeq != $.MvcSheetUI.GetControlValue("DHTbl.DHSeq", i + 1)) {
                DHSeq = $.MvcSheetUI.GetControlValue("DHTbl.DHSeq", i + 1);
                var SeqCnt = $.MvcSheetUI.GetControlValue("DHTbl.SeqCnt", i + 1);
                var RejectFlg = $.MvcSheetUI.GetControlValue("DHTbl.RejectFlg", i + 1);
                var DisplayName = $.MvcSheetUI.GetControlValue("DHTbl.DisplayName", i + 1);
                var k = 0;
                $("[data-datafield='DHTbl']").find("tr.rows").each(function () {
                    if (k == i) {
                        $(this).find("td[data-field='DHTbl.TheNo']").attr("rowspan", SeqCnt);
                        $(this).find("td[data-field='DHTbl.DHType']").attr("rowspan", SeqCnt);
                        $(this).find("td[data-field='DHTbl.DHSeq']").attr("rowspan", SeqCnt);
                        $(this).find("td[data-field='DHTbl.ShippingType']").attr("rowspan", SeqCnt);
                        $(this).find("td[data-field='DHTbl.Supplier']").attr("rowspan", SeqCnt);
                        $(this).find("td[data-field='DHTbl.DisplayName']").attr("rowspan", SeqCnt);
                        $(this).find("td[data-field='DHTbl.Operate']").attr("rowspan", SeqCnt);
                        if (RejectFlg == "1" || DisplayName == "草稿") {
                            $(this).find("td[data-field='DHTbl.Operate'] a.updateDH").show();
                        } else {
                            $(this).find("td[data-field='DHTbl.Operate'] a.updateDH").hide();
                        }
                    }
                    k++;
                });
            } else {
                DHSeq = $.MvcSheetUI.GetControlValue("DHTbl.DHSeq", i + 1);
                var k = 0;
                $("[data-datafield='DHTbl']").find("tr.rows").each(function () {
                    if (k == i) {
                        $(this).find("td[data-field='DHTbl.TheNo']").remove();
                        $(this).find("td[data-field='DHTbl.DHType']").remove();
                        $(this).find("td[data-field='DHTbl.DHSeq']").remove();
                        $(this).find("td[data-field='DHTbl.ShippingType']").remove();
                        $(this).find("td[data-field='DHTbl.Supplier']").remove();
                        $(this).find("td[data-field='DHTbl.DisplayName']").remove();
                        $(this).find("td[data-field='DHTbl.Operate']").remove();
                    }
                    k++;
                });
            }


        }
    }

    // 合同变更子表的显示判断
    var rowp = 0;
    $("[data-datafield='BGTbl']").find("tr.rows").each(function () {
        rowp++;
        var Status = $.MvcSheetUI.GetControlValue("BGTbl.Status", rowp);
        var RejectFlg = $.MvcSheetUI.GetControlValue("BGTbl.RejectFlg", rowp);
        var DisplayName = $.MvcSheetUI.GetControlValue("BGTbl.DisplayName", rowp);

        if (Status == "4") {
            if (RejectFlg == "1" || DisplayName == "草稿") {
                $(this).find("td[data-field='BGTbl.Operate'] a.updateBG").show();
            } else {
                $(this).find("td[data-field='BGTbl.Operate'] a.updateBG").hide();
            }
        } else {
            if (RejectFlg == "1" || DisplayName == "草稿") {
                $(this).find("td[data-field='BGTbl.Operate'] a.updateBG").show();
            } else {
                $(this).find("td[data-field='BGTbl.Operate'] a.updateBG").hide();
            }
        }

    });

    // 保函子表的显示判断
    var rowp = 0;
    $("[data-datafield='BHTbl']").find("tr.rows").each(function () {
        rowp++;
        var Status = $.MvcSheetUI.GetControlValue("BHTbl.Status", rowp);
        var RejectFlg = $.MvcSheetUI.GetControlValue("BHTbl.RejectFlg", rowp);
        var DisplayName = $.MvcSheetUI.GetControlValue("BHTbl.TBStatus", rowp);

        if (DisplayName == "未退") {
            $(this).find("td[data-field='BHTbl.Operate'] a.updateBH").hide();
        } else if (DisplayName == "驳回") {
            $(this).find("td[data-field='BHTbl.TB'] a.doTB").hide();
        } else if (DisplayName == "审批中" || DisplayName == "确认中") {
            $(this).find("td[data-field='BHTbl.Edit'] a.editBH").hide();
            $(this).find("td[data-field='BHTbl.TB'] a.doTB").hide();
            $(this).find("td[data-field='BHTbl.Operate'] a.updateBH").hide();
        } else if (DisplayName == "没收" || DisplayName == "已退") {
            $(this).find("td[data-field='BHTbl.Edit'] a.editBH").hide();
            $(this).find("td[data-field='BHTbl.TB'] a.doTB").hide();
            $(this).find("td[data-field='BHTbl.Operate'] a.updateBH").hide();
        }

    });

    // 合同文件归档子表的显示判断
    var rowp = 0;
    $("[data-datafield='ContractFileArchiveTbl']").find("tr.rows").each(function () {
        rowp++;
        var Status = $.MvcSheetUI.GetControlValue("ContractFileArchiveTbl.Status", rowp);
        var RejectFlg = $.MvcSheetUI.GetControlValue("ContractFileArchiveTbl.RejectFlg", rowp);
        var DisplayName = $.MvcSheetUI.GetControlValue("ContractFileArchiveTbl.DisplayName", rowp);

        if (DisplayName == "驳回") {
            $(this).find("td[data-field='ContractFileArchiveTbl.Operate'] a.updateGD").show();
        } else {
            $(this).find("td[data-field='ContractFileArchiveTbl.Operate'] a.updateGD").hide();
        }

    });
  

    // 审签节点中显示不显示
    var ContractNo = $.MvcSheetUI.GetControlValue("ContractNo");
    var ContractType = "";
    var ContractProperty = "";
    var AgencyType = "";
    if (ContractNo != null && ContractNo != "") {
        // 根据合同号码获取对应合同相关数据
        $.ajax({
            type: "POST",    //页面请求的类型
            url: "ContractHandler.ashx?Command=getByContractNo",   //处理页的相对地址
            data: {
                ContractNo: ContractNo,
            },
            //async: false,
            success: function (ret) {    //这是处理后执行的函数，msg是处理页返回的数据
                if (ret.ContractNo != null && ret.ContractNo != "") {
                    ContractType = ret.ContractType;
                    ContractProperty = ret.ContractProperty;
                    AgencyType = ret.AgencyType;
                    if (ContractType == "国内合同") {
                        $(".NotHYDiv").show();
                        $(".HYDiv").hide();
                        $(".JKDiv").hide();
                    } else if (ContractType == "进口合同") {
                        $(".NotHYDiv").show();
                        if (ContractProperty == "航空煤油") {
                            $(".HYDiv").show();
                        } else {
                            $(".HYDiv").hide();
                        }
                        $(".JKDiv").show();
                    }

                    if (AgencyType == '不需要' || AgencyType == '') {
                        $('.AgencyFile').hide();
                        $('.AgencySelect').hide();
                        $('.AgencyAfterRemark').hide();
                        $('.AgencyComment').hide();
                    } else if (AgencyType == '已审') {
                        if (ContractProperty == '航空煤油') {
                            $('.AgencyFile').show();
                            $('.AgencySelect').hide();
                        } else {
                            $('.AgencyFile').hide();
                            $('.AgencySelect').show();
                        }
                        $('.AgencyAfterRemark').hide();
                        $('.AgencyComment').show();
                    } else if (AgencyType == '后审') {
                        $('.AgencyFile').hide();
                        $('.AgencySelect').hide();
                        $('.AgencyAfterRemark').show();
                        $('.AgencyComment').hide();
                    }


                    // 归档
                    if (ContractType == "国内合同") {
                        $(".GDAgencyHY").hide();
                        $(".GDAgencyNoHY").show();
                    } else {
                        if (ContractProperty == "航空煤油") {
                            $(".GDAgencyHY").show();
                            $(".GDAgencyNoHY").hide();

                        } else {
                            $(".GDAgencyHY").hide();
                            $(".GDAgencyNoHY").show();
                        }
                    }
                }
                
            }
        });
    }



    $(".divContent_Tab div[data-title='征询意见']").parent().hide();

}

// 点击执行中的各个图片
function clickToggle(Type, opflg) {
    $('.bannerTitle' + Type).next().show();
    if (opflg == "1") {
        $('.bt_progress_child_long1').removeClass("bt_progress_child_long1").addClass("bt_progress_child_long2");
        $('.operateChild' + Type).removeClass("bt_progress_child_long2").addClass("bt_progress_child_long1");
    }
    $('.Operate' + Type).click();
}

// 生成合同号
function generateContractNo() {
    // 合同类型
    var ContractType = $.MvcSheetUI.GetControlValue("ContractType");
    // 合同性质
    var ContractProperty = $.MvcSheetUI.GetControlValue("ContractProperty");
    // 工程编码
    var SubProjectCode = $.MvcSheetUI.GetControlValue("SubProjectCode");
    // 国别编码
    var Country = $.MvcSheetUI.GetControlValue("Country");
    if (ContractType == "") {
        alert("请选择合同类型!");
    } else if (ContractProperty == "") {
        alert("请选择合同性质!");
    } else if (SubProjectCode == "") {
        alert("请选择最终用户!");
    } else {
        if (ContractType == "JK" && Country == "" ) {
            alert("请选择国别!");
        } else {
            //给合同号申请成功标识符赋值
            $.ajax({
                type: "POST",    //页面请求的类型
                url: "ContractHandler.ashx?Command=generateContractNo",   //处理页的相对地址
                data: {
                    ContractType: ContractType,
                    ContractProperty: ContractProperty,
                    SubProjectCode: SubProjectCode,
                    Country: Country,
                },
                async: false,
                success: function (ret) {    //这是处理后执行的函数，msg是处理页返回的数据
                    $.MvcSheetUI.SetControlValue("ContractNo", ret);

                }
            });
        }
        
    }

}
// 申请修改合同号
function ApplyContractNo() {
    var ContractNo = $.MvcSheetUI.GetControlValue("ContractNo");
    var ContractName = $.MvcSheetUI.GetControlValue("ContractName");
    var canUpdateFlg = true;
    //判断当前合同号是否有数据（是否进行保存过）
    $.ajax({
        type: "POST",    //页面请求的类型
        url: "ContractHandler.ashx?Command=getByContractNo",   //处理页的相对地址
        data: {
            ContractNo: ContractNo,
        },
        async: false,
        success: function (ret) {    //这是处理后执行的函数，msg是处理页返回的数据
            if (ret.ContractNo == null || ret.ContractNo == '') {
                alert("合同号还不存在，无法申请修改（请先进行保存）");
                canUpdateFlg = false;
            }
        }
    });
    if (canUpdateFlg) {
        //判断当前合同号是否正在审批中
        var dtl = $.MvcSheetUI.GetElement("UpdateNoTbl").SheetGridView();
        var len = dtl.RowCount;
        if (len > 0 && $.MvcSheetUI.GetControlValue("UpdateNoTbl.Status", 1) == "审批中") {
            alert("当前有正在审批中的数据，不能进行申请！");
            return false;
        }
        var WorkflowVersion_Update = $.MvcSheetUI.GetControlValue("WorkflowVersion_Update");
        // window.location.href = "/Portal/StartInstance.html?WorkflowCode=Apply2&ContractNo=" + ContractNo + "&ContractName=" + ContractName;
        //window.location.href = "/Portal/MvcDefaultSheet.aspx?SheetCode=UpdateContractNoMy&Mode=Originate&WorkflowCode=UpdateContractNo&WorkflowVersion=" + WorkflowVersion_Update + "&ContractNo=" + ContractNo + "&ContractName=" + ContractName;
        window.location.href = "/Portal/Sheets/Contract/UpdateContractNoMy.aspx?Mode=Originate&WorkflowCode=UpdateContractNo&WorkflowVersion=" + WorkflowVersion_Update + "&ContractNo=" + ContractNo;

    }
}

// 申请审签
function ApplyApprove() {
    //判断当前合同是否已经申请过审签
    var ContractNo = $.MvcSheetUI.GetControlValue("ContractNo");
    var ContractFileCount = 0;
    var TalkFileCount = 0;
    $("div[data-datafield='ContractFile']").find(".LongWord").each(function () {
        ContractFileCount++;
    }); 
    if (ContractFileCount == 0) {
        alert("请上传合同文本！");
        return false;
    }
    $("div[data-datafield='TalkFile']").find(".LongWord").each(function () {
        TalkFileCount++;
    }); 
    if (TalkFileCount == 0) {
        alert("请上传合同谈判小结！");
        return false;
    }
    
    
    var canApproveFlg = true;
    $.ajax({
        type: "POST",    //页面请求的类型
        url: "ContractHandler.ashx?Command=getBizStatusOfContract",   //处理页的相对地址
        data: {
            ContractNo: ContractNo,
            BizNo: "ContractApprove",
        },
        async: false,
        success: function (ret) {    //这是处理后执行的函数，msg是处理页返回的数据
            if (ret == null || ret == '') {
                canApproveFlg = true;
            } else {
                canApproveFlg = false;
                alert("当前有正在申请中的数据，不能进行申请！");
            }
        }
    });

   if (canApproveFlg == true) {
        $.MvcSheetUI.SetControlValue("ToApproveSubFlg","true");
        // 提交（不弹出确认框）
        $.MvcSheet.Submit2(this);
        //var url = "";
        //$.ajax({
        //    type: "POST",    //页面请求的类型
        //    url: "ContractHandler.ashx?Command=getWorkItemIDByICPID",   //处理页的相对地址
        //    data: {
        //        InstanceId: $.MvcSheetUI.SheetInfo.InstanceId,
        //    },
        //    async: false,
        //    success: function (ret) {    //这是处理后执行的函数，msg是处理页返回的数据
        //        if (ret == null || ret == '') {
        //            alert("跳转失败，请尝试手动进入审签子页面！");
        //        } else {
        //            // 跳转到审签子页面
        //            url = "/Portal/Sheets/Contract/ContractApproveMy.aspx?Mode=Work&WorkItemID=" + ret;
        //        }
        //    }
        //});
        //window.location.href = url;
    // 提交(jqury 提交)
    //$(".navbar-inner [data-action='Submit']").click();

        // 发起审签子页面
        //var WorkflowVersion_Approve = $.MvcSheetUI.GetControlValue("WorkflowVersion_Approve");
        //window.location.href = "/Portal/Sheets/Contract/ContractApproveMy.aspx?Mode=Originate&WorkflowCode=ContractApprove&WorkflowVersion=" + WorkflowVersion_Approve + "&ContractNo=" + ContractNo;

   }

}


// 申请信用证
function ApprovePayment() {
    var ContractNo = $.MvcSheetUI.GetControlValue("ContractNo");
    var WorkflowVersion_Payment = $.MvcSheetUI.GetControlValue("WorkflowVersion_Payment");
    window.location.href = "/Portal/Sheets/Contract/PaymentMy.aspx?Mode=Originate&WorkflowCode=PaymentSub&WorkflowVersion=" + WorkflowVersion_Payment + "&ContractNo=" + ContractNo;

}

// 申请进口许可证
function ApproveImportLicense() {
    var ContractNo = $.MvcSheetUI.GetControlValue("ContractNo");
    var WorkflowVersion_ImportLicense = $.MvcSheetUI.GetControlValue("WorkflowVersion_ImportLicense");
    window.location.href = "/Portal/Sheets/Contract/ImportLicenseMy.aspx?Mode=Originate&WorkflowCode=ImportLicenseSub&WorkflowVersion=" + WorkflowVersion_ImportLicense + "&ContractNo=" + ContractNo;
}

// 申请到货
function ApproveDH() {
    var ContractNo = $.MvcSheetUI.GetControlValue("ContractNo");
    var ContractProperty = $.MvcSheetUI.GetControlValue("ContractProperty");
    var WorkflowVersion_DH = $.MvcSheetUI.GetControlValue("WorkflowVersion_DH");
    var WorkflowVersion_DHHY = $.MvcSheetUI.GetControlValue("WorkflowVersion_DHHY");
    if (ContractProperty == "ContractProperty_HKMY") {
        window.location.href = "/Portal/Sheets/Contract/DHHYMy.aspx?Mode=Originate&WorkflowCode=DHHY&WorkflowVersion=" + WorkflowVersion_DHHY + "&ContractNo=" + ContractNo + "&IsHYFlg=1";
    } else {
        window.location.href = "/Portal/Sheets/Contract/DHMy.aspx?Mode=Originate&WorkflowCode=DH&WorkflowVersion=" + WorkflowVersion_DH + "&ContractNo=" + ContractNo + "&IsHYFlg=1";
    }
}

// 申请合同变更
function ApproveBG() {
    var ContractNo = $.MvcSheetUI.GetControlValue("ContractNo");
    var WorkflowVersion_BG = $.MvcSheetUI.GetControlValue("WorkflowVersion_BG");
    window.location.href = "/Portal/Sheets/Contract/BGMy.aspx?Mode=Originate&WorkflowCode=BG&WorkflowVersion=" + WorkflowVersion_BG + "&ContractNo=" + ContractNo;
}

// 申请保函
function ApproveBH() {
    var ContractNo = $.MvcSheetUI.GetControlValue("ContractNo");
    var WorkflowVersion_BH = $.MvcSheetUI.GetControlValue("WorkflowVersion_BH");
    window.location.href = "/Portal/Sheets/Contract/BHMy.aspx?Mode=Originate&WorkflowCode=BH&WorkflowVersion=" + WorkflowVersion_BH + "&ContractNo=" + ContractNo + "&BHFlg=New";
}

// 申请合同文件归档
function ApplyFileGD() {
    var ContractNo = $.MvcSheetUI.GetControlValue("ContractNo");
    var WorkflowVersion_GD = $.MvcSheetUI.GetControlValue("WorkflowVersion_GD");
    window.location.href = "/Portal/Sheets/Contract/GDMy.aspx?Mode=Originate&WorkflowCode=GD&WorkflowVersion=" + WorkflowVersion_GD + "&ContractNo=" + ContractNo ;
}

// 申请合同变更归档
function ApplyFileGDChange() {
    var ContractNo = $.MvcSheetUI.GetControlValue("ContractNo");
    var WorkflowVersion_GDChange = $.MvcSheetUI.GetControlValue("WorkflowVersion_GDChange");
    window.location.href = "/Portal/Sheets/Contract/GDChangeMy.aspx?Mode=Originate&WorkflowCode=GDChange&WorkflowVersion=" + WorkflowVersion_GDChange + "&ContractNo=" + ContractNo ;
}



// 申请请款
function ApproveQK() {
    var ContractNo = $.MvcSheetUI.GetControlValue("ContractNo");
    var WorkflowVersion_QK = $.MvcSheetUI.GetControlValue("WorkflowVersion_QK");
    window.location.href = "/Portal/Sheets/Contract/QKMy.aspx?Mode=Originate&WorkflowCode=QK&WorkflowVersion=" + WorkflowVersion_QK + "&ContractNo=" + ContractNo;
}

// 申请到款
function ApproveDK() {
    var ContractNo = $.MvcSheetUI.GetControlValue("ContractNo");
    var WorkflowVersion_DK = $.MvcSheetUI.GetControlValue("WorkflowVersion_DK");
    window.location.href = "/Portal/Sheets/Contract/DKMy.aspx?Mode=Originate&WorkflowCode=DK&WorkflowVersion=" + WorkflowVersion_DK + "&ContractNo=" + ContractNo;
}

// 申请付款
function ApproveFK() {
    var ContractNo = $.MvcSheetUI.GetControlValue("ContractNo");
    var WorkflowVersion_FK = $.MvcSheetUI.GetControlValue("WorkflowVersion_FK");
    window.location.href = "/Portal/Sheets/Contract/FKMy.aspx?Mode=Originate&WorkflowCode=FK&WorkflowVersion=" + WorkflowVersion_FK + "&ContractNo=" + ContractNo;
}

// 申请结算
function ApproveJS() {
    var ContractNo = $.MvcSheetUI.GetControlValue("ContractNo");
    var WorkflowVersion_JS = $.MvcSheetUI.GetControlValue("WorkflowVersion_JS");
    window.location.href = "/Portal/Sheets/Contract/JSMy.aspx?Mode=Originate&WorkflowCode=JS&WorkflowVersion=" + WorkflowVersion_JS + "&ContractNo=" + ContractNo;
}


// 
function EmailSalerChange() {
    var dtl = $.MvcSheetUI.GetElement('SalerTbl').SheetGridView();
    var len = dtl.RowCount;
    dtl._AddRow();
    var CompanyNameSaler = $.MvcSheetUI.GetControlValue('CompanyNameSaler');
    var ContactNameSaler = $.MvcSheetUI.GetControlValue('ContactNameSaler');
    var TelephoneSaler = $.MvcSheetUI.GetControlValue('TelephoneSaler');
    var MobileSaler = $.MvcSheetUI.GetControlValue('MobileSaler');
    var FaxSaler = $.MvcSheetUI.GetControlValue('FaxSaler');
    var EmailSaler = $.MvcSheetUI.GetControlValue('EmailSaler');
    $.MvcSheetUI.SetControlValue("SalerTbl.CompanyName", CompanyNameSaler, len + 1);
    $.MvcSheetUI.SetControlValue("SalerTbl.ContactName", ContactNameSaler, len + 1);
    $.MvcSheetUI.SetControlValue("SalerTbl.Telephone", TelephoneSaler, len + 1);
    $.MvcSheetUI.SetControlValue("SalerTbl.Mobile", MobileSaler, len + 1);
    $.MvcSheetUI.SetControlValue("SalerTbl.Fax", FaxSaler, len + 1);
    $.MvcSheetUI.SetControlValue("SalerTbl.Email", EmailSaler, len + 1);
    $("input[data-datafield='SalerTbl.CompanyName']").attr("disabled", "disabled");
    $("input[data-datafield='SalerTbl.ContactName']").attr("disabled", "disabled");
    $("input[data-datafield='SalerTbl.Telephone']").attr("disabled", "disabled");
    $("input[data-datafield='SalerTbl.Mobile']").attr("disabled", "disabled");
    $("input[data-datafield='SalerTbl.Fax']").attr("disabled", "disabled");
    $("input[data-datafield='SalerTbl.Email']").attr("disabled", "disabled");
    $.MvcSheetUI.SetControlValue('Salers', $.MvcSheetUI.GetControlValue('Salers') + ContactNameSaler + ',')

}
// 航油合同预设数据
function setDataFromHY() {
    var ContractProperty = $.MvcSheetUI.GetControlValue('ContractProperty');
    if (ContractProperty == 'ContractProperty_HKMY') {
        $.ajax({
            type: "POST",    //页面请求的类型
            url: "ContractHandler.ashx?Command=getHYData",   //处理页的相对地址
            data: {
            },
            async: false,
            success: function (ret) {    //这是处理后执行的函数，msg是处理页返回的数据
                if (ret.ObjectID != null && ret.ObjectID != '') {
                    $.MvcSheetUI.SetControlValue("FinalUser", ret.FinalUser);
                    $.MvcSheetUI.SetControlValue("PostB", ret.PostB);
                    $.MvcSheetUI.SetControlValue("BidType", ret.BidType);
                    BidTypeChange();
                    $.MvcSheetUI.SetControlValue("BidNo", ret.BidNo);
                    $.MvcSheetUI.SetControlValue("ContractName", ret.ContractName);
                    $.MvcSheetUI.SetControlValue("ContractShortName", ret.ContractShortName);
                    $.MvcSheetUI.SetControlValue("ProjectName", ret.ProjectName);
                    $.MvcSheetUI.SetControlValue("SubProjectName", ret.SubProjectName);
                    $.MvcSheetUI.SetControlValue("SubProjectCode", ret.SubProjectCode);
                    $.MvcSheetUI.SetControlValue("TradeMethod", ret.TradeMethod);
                    $.MvcSheetUI.SetControlValue("Country", ret.Country);
                    $.MvcSheetUI.SetControlValue("ContractRemark", ret.ContractRemark);

                    $.ajax({
                        type: "POST",    //页面请求的类型
                        url: "ContractHandler.ashx?Command=getSalesHYData",   //处理页的相对地址
                        data: {
                            ObjectID : ret.ObjectID
                        },
                        async: false,
                        success: function (ret) {    //这是处理后执行的函数，msg是处理页返回的数据
                            var dtl = $.MvcSheetUI.GetElement("SalerTbl").SheetGridView();
                            dtl._Clear();
                            for (var i = 0; i < ret.length; i++) {
                                dtl._AddRow();
                                $.MvcSheetUI.SetControlValue("SalerTbl.CompanyName", ret[i].CompanyName, i + 1);
                                $.MvcSheetUI.SetControlValue("SalerTbl.ContactName", ret[i].ContactName, i + 1);
                                $.MvcSheetUI.SetControlValue("SalerTbl.Telephone", ret[i].Telephone, i + 1);
                                $.MvcSheetUI.SetControlValue("SalerTbl.Mobile", ret[i].Mobile, i + 1);
                                $.MvcSheetUI.SetControlValue("SalerTbl.Fax", ret[i].Fax, i + 1);
                                $.MvcSheetUI.SetControlValue("SalerTbl.Email", ret[i].Email, i + 1);
                            }
                            $("input[data-datafield='SalerTbl.CompanyName']").attr("disabled", "disabled");
                            $("input[data-datafield='SalerTbl.ContactName']").attr("disabled", "disabled");
                            $("input[data-datafield='SalerTbl.Telephone']").attr("disabled", "disabled");
                            $("input[data-datafield='SalerTbl.Mobile']").attr("disabled", "disabled");
                            $("input[data-datafield='SalerTbl.Fax']").attr("disabled", "disabled");
                            $("input[data-datafield='SalerTbl.Email']").attr("disabled", "disabled"); 
                        }
                    });

                    $.MvcSheetUI.SetControlValue("Salers", ret.Salers);

                    $.ajax({
                        type: "POST",    //页面请求的类型
                        url: "ContractHandler.ashx?Command=getBidsHYData",   //处理页的相对地址
                        data: {
                            ObjectID: ret.ObjectID
                        },
                        async: false,
                        success: function (ret) {    //这是处理后执行的函数，msg是处理页返回的数据
                            var dtl = $.MvcSheetUI.GetElement("BidTbl").SheetGridView();
                            dtl._Clear();
                            for (var i = 0; i < ret.length; i++) {
                                dtl._AddRow();
                                $.MvcSheetUI.SetControlValue("BidTbl.ProjectShortName", ret[i].ProjectShortName, i + 1);
                                $.MvcSheetUI.SetControlValue("BidTbl.BidPrice", ret[i].BidPrice, i + 1);
                            }
                            $("input[data-datafield='BidTbl.ProjectShortName']").attr("disabled", "disabled");
                            $("input[data-datafield='BidTbl.BidPrice']").attr("disabled", "disabled");
                        }
                    });
                }
            }
        });
    }
}

function viewUpdateNo(el) {
    var rowIndex = el.parentElement.parentElement.rowIndex;
    var WorkItemId = $.MvcSheetUI.GetControlValue('UpdateNoTbl.WorkItemId', rowIndex - 1);
    window.location.href = "/Portal/Sheets/Contract/UpdateContractNoMy.aspx?Mode=View&WorkItemID=" + WorkItemId;
}

function viewApprove(el) {
    var rowIndex = el.parentElement.parentElement.rowIndex;
    var WorkItemId = $.MvcSheetUI.GetControlValue('ContractApproveTbl.WorkItemId', rowIndex - 1);
    window.location.href = "/Portal/Sheets/Contract/ContractApproveMy.aspx?Mode=View&WorkItemID=" + WorkItemId;
}

// 信用证改证
function updatePaymentApprove(el) {
    var ContractNo = $.MvcSheetUI.GetControlValue("ContractNo");
    var rowIndex = el.parentElement.parentElement.rowIndex;
    var PaymentId = $.MvcSheetUI.GetControlValue('PaymentTbl.PaymentId', rowIndex - 1);
    var WorkflowVersion_PaymentUpdate = $.MvcSheetUI.GetControlValue("WorkflowVersion_PaymentUpdate");
    window.location.href = "/Portal/Sheets/Contract/PaymentUpdateMy.aspx?Mode=Originate&WorkflowCode=PaymentUpdateSub&WorkflowVersion=" + WorkflowVersion_PaymentUpdate + "&ContractNo=" + ContractNo + "&PaymentId=" + PaymentId;
}
// 信用证查看
function viewPayment(el) {
    var rowIndex = el.parentElement.parentElement.rowIndex;
    var WorkItemId = $.MvcSheetUI.GetControlValue('PaymentTbl.WorkItemId', rowIndex - 1);
    var TheNo = $.MvcSheetUI.GetControlValue('PaymentTbl.TheNo', rowIndex - 1);
    if (TheNo == "") {
        window.location.href = "/Portal/Sheets/Contract/PaymentUpdateMy.aspx?Mode=View&WorkItemID=" + WorkItemId;
    } else {
        window.location.href = "/Portal/Sheets/Contract/PaymentMy.aspx?Mode=View&WorkItemID=" + WorkItemId;
    }
    
}
// 信用证修改
function updatePayment(el) {
    var rowIndex = el.parentElement.parentElement.rowIndex;
    var WorkItemId = $.MvcSheetUI.GetControlValue('PaymentTbl.WorkItemId', rowIndex - 1);
    var TheNo = $.MvcSheetUI.GetControlValue('PaymentTbl.TheNo', rowIndex - 1);
    if (TheNo == "") {
        window.location.href = "/Portal/Sheets/Contract/PaymentUpdateMy.aspx?Mode=Work&WorkItemID=" + WorkItemId;
    } else {
        window.location.href = "/Portal/Sheets/Contract/PaymentMy.aspx?Mode=Work&WorkItemID=" + WorkItemId;
    }
}

// 进口许可证查看
function viewImportLicence(el) {
    var rowIndex = el.parentElement.parentElement.rowIndex;
    var WorkItemId = $.MvcSheetUI.GetControlValue('ImportLicenceTbl.WorkItemId', rowIndex - 1);
    window.location.href = "/Portal/Sheets/Contract/ImportLicenseMy.aspx?Mode=View&WorkItemID=" + WorkItemId;
}

// 进口许可证修改
function updateImportLicence(el) {
    var rowIndex = el.parentElement.parentElement.rowIndex;
    var WorkItemId = $.MvcSheetUI.GetControlValue('ImportLicenceTbl.WorkItemId', rowIndex - 1);
    window.location.href = "/Portal/Sheets/Contract/ImportLicenseMy.aspx?Mode=Work&WorkItemID=" + WorkItemId;
}

// 进口许可证废除
function cancelImportLicence(el) {
    var rowIndex = el.parentElement.parentElement.rowIndex;
    var ImportLicenseId = $.MvcSheetUI.GetControlValue('ImportLicenceTbl.ImportLicenseId', rowIndex - 1);
    $.ajax({
        type: "POST",    //页面请求的类型
        url: "ContractHandler.ashx?Command=cancelImportLicence",   //处理页的相对地址
        data: {
            ImportLicenseId: ImportLicenseId,
            flg: "cancel",
        },
        async: false,
        success: function (ret) {    //这是处理后执行的函数，msg是处理页返回的数据
            var rowp = 1;
            $("[data-datafield='ImportLicenceTbl']").find("tr.rows").each(function () {
                if (rowp == rowIndex - 1) {
                    $(this).find("td[data-field='ImportLicenceTbl.Operate'] a.cancelImportLicence").hide();
                    $(this).find("td[data-field='ImportLicenceTbl.Operate'] a.undocancelImportLicence").show();
                    $(this).find("td[data-field='ImportLicenceTbl.DisplayName']").text("已废除");
                }
                rowp++;
            });
        }
    });
}

// 编辑资金计划
function EditZJPlan(el) {
    var ContractNo = $.MvcSheetUI.GetControlValue("ContractNo");
    var WorkItemId = $.MvcSheetUI.GetControlValue('PlanWorkItemId');
    var WorkflowVersion_Plan = $.MvcSheetUI.GetControlValue('WorkflowVersion_Plan');
    // 为空则发起流程，否则修改即可
    if (WorkItemId == "") {
        window.location.href = "/Portal/Sheets/Contract/ZJPlanMy.aspx?Mode=Originate&WorkflowCode=ZJPlan&WorkflowVersion=" + WorkflowVersion_Plan + "&ContractNo=" + ContractNo;
    } else {
        window.location.href = "/Portal/Sheets/Contract/ZJPlanMy.aspx?Mode=Work&WorkItemID=" + WorkItemId;
    }
}

// 到货查看
function viewDH(el) {
    var rowIndex = el.parentElement.parentElement.rowIndex;
    var WorkItemId = $.MvcSheetUI.GetControlValue('DHTbl.WorkItemId', rowIndex - 1);
    window.location.href = "/Portal/Sheets/Contract/DHMy.aspx?Mode=View&WorkItemID=" + WorkItemId;
}

// 到货修改
function updateDH(el) {
    var rowIndex = el.parentElement.parentElement.rowIndex;
    var WorkItemId = $.MvcSheetUI.GetControlValue('DHTbl.WorkItemId', rowIndex - 1);
    window.location.href = "/Portal/Sheets/Contract/DHMy.aspx?Mode=Work&WorkItemID=" + WorkItemId;
}

// 变更查看
function viewBG(el) {
    var rowIndex = el.parentElement.parentElement.rowIndex;
    var WorkItemId = $.MvcSheetUI.GetControlValue('BGTbl.WorkItemId', rowIndex - 1);
    window.location.href = "/Portal/Sheets/Contract/BGMy.aspx?Mode=View&WorkItemID=" + WorkItemId;
}

// 变更修改
function updateBG(el) {
    var rowIndex = el.parentElement.parentElement.rowIndex;
    var WorkItemId = $.MvcSheetUI.GetControlValue('BGTbl.WorkItemId', rowIndex - 1);
    window.location.href = "/Portal/Sheets/Contract/BGMy.aspx?Mode=Work&WorkItemID=" + WorkItemId;
}

// 查看保函
function viewBH(el) {
    var rowIndex = el.parentElement.parentElement.rowIndex;
    var WorkItemId = $.MvcSheetUI.GetControlValue('BHTbl.WorkItemId', rowIndex - 1);
    window.location.href = "/Portal/Sheets/Contract/BHMy.aspx?Mode=View&WorkItemID=" + WorkItemId;
}

// 编辑保函
function editBH(el) {
    var rowIndex = el.parentElement.parentElement.rowIndex;
    var WorkItemId = $.MvcSheetUI.GetControlValue('BHTbl.WorkItemId', rowIndex - 1);
    window.location.href = "/Portal/Sheets/Contract/BHMy.aspx?Mode=Work&WorkItemID=" + WorkItemId ;
}

// 修改保函（同退保）
function updateBH(el) {
    var rowIndex = el.parentElement.parentElement.rowIndex;
    var WorkItemId = $.MvcSheetUI.GetControlValue('BHTbl.WorkItemId', rowIndex - 1);
    window.location.href = "/Portal/Sheets/Contract/BHMy.aspx?Mode=Work&WorkItemID=" + WorkItemId + "&BHFlg=Apply";
}

// 退保
function doTB(el) {
    var rowIndex = el.parentElement.parentElement.rowIndex;
    var WorkItemId = $.MvcSheetUI.GetControlValue('BHTbl.WorkItemId', rowIndex - 1);
    window.location.href = "/Portal/Sheets/Contract/BHMy.aspx?Mode=Work&WorkItemID=" + WorkItemId + "&BHFlg=Apply";
}

// 归档查看
function viewGD(el) {
    var rowIndex = el.parentElement.parentElement.rowIndex;
    var WorkItemId = $.MvcSheetUI.GetControlValue('ContractFileArchiveTbl.WorkItemId', rowIndex - 1);
    window.location.href = "/Portal/Sheets/Contract/GDMy.aspx?Mode=View&WorkItemID=" + WorkItemId;
}

// 归档修改
function updateGD(el) {
    var rowIndex = el.parentElement.parentElement.rowIndex;
    var WorkItemId = $.MvcSheetUI.GetControlValue('ContractFileArchiveTbl.WorkItemId', rowIndex - 1);
    window.location.href = "/Portal/Sheets/Contract/GDMy.aspx?Mode=Work&WorkItemID=" + WorkItemId;
}

// 变更归档查看
function viewGDChange(el) {
    var rowIndex = el.parentElement.parentElement.rowIndex;
    var WorkItemId = $.MvcSheetUI.GetControlValue('ChangeArchiveTbl.WorkItemId', rowIndex - 1);
    window.location.href = "/Portal/Sheets/Contract/GDChangeMy.aspx?Mode=View&WorkItemID=" + WorkItemId;
}

// 变更归档修改
function updateGDChange(el) {
    var rowIndex = el.parentElement.parentElement.rowIndex;
    var WorkItemId = $.MvcSheetUI.GetControlValue('ChangeArchiveTbl.WorkItemId', rowIndex - 1);
    window.location.href = "/Portal/Sheets/Contract/GDChangeMy.aspx?Mode=Work&WorkItemID=" + WorkItemId;
}

// 请款查看
function viewQK(el) {
    var rowIndex = el.parentElement.parentElement.rowIndex;
    var WorkItemId = $.MvcSheetUI.GetControlValue('QKMainTbl.WorkItemId', rowIndex - 1);
    window.location.href = "/Portal/Sheets/Contract/QKMy.aspx?Mode=View&WorkItemID=" + WorkItemId;
}

// 请款修改
function updateQK(el) {
    var rowIndex = el.parentElement.parentElement.rowIndex;
    var WorkItemId = $.MvcSheetUI.GetControlValue('QKMainTbl.WorkItemId', rowIndex - 1);
    window.location.href = "/Portal/Sheets/Contract/QKMy.aspx?Mode=Work&WorkItemID=" + WorkItemId;
}

// 到款查看
function viewDK(el) {
    var rowIndex = el.parentElement.parentElement.rowIndex;
    var WorkItemId = $.MvcSheetUI.GetControlValue('DKRecordTbl.WorkItemId', rowIndex - 1);
    window.location.href = "/Portal/Sheets/Contract/DKMy.aspx?Mode=View&WorkItemID=" + WorkItemId;
}

// 到款修改
function updateDK(el) {
    var rowIndex = el.parentElement.parentElement.rowIndex;
    var WorkItemId = $.MvcSheetUI.GetControlValue('DKRecordTbl.WorkItemId', rowIndex - 1);
    window.location.href = "/Portal/Sheets/Contract/DKMy.aspx?Mode=Work&WorkItemID=" + WorkItemId;
}

// 付款查看
function viewFK(el) {
    var rowIndex = el.parentElement.parentElement.rowIndex;
    var WorkItemId = $.MvcSheetUI.GetControlValue('FKRecordTbl.WorkItemId', rowIndex - 1);
    window.location.href = "/Portal/Sheets/Contract/FKMy.aspx?Mode=View&WorkItemID=" + WorkItemId;
}

// 付款修改
function updateFK(el) {
    var rowIndex = el.parentElement.parentElement.rowIndex;
    var WorkItemId = $.MvcSheetUI.GetControlValue('FKRecordTbl.WorkItemId', rowIndex - 1);
    window.location.href = "/Portal/Sheets/Contract/FKMy.aspx?Mode=Work&WorkItemID=" + WorkItemId;
}

// 拒付付款查看
function viewFKJF(el) {
    var rowIndex = el.parentElement.parentElement.rowIndex;
    var WorkItemId = $.MvcSheetUI.GetControlValue('FKJFRecordTbl.WorkItemId', rowIndex - 1);
    window.location.href = "/Portal/Sheets/Contract/FKMy.aspx?Mode=View&WorkItemID=" + WorkItemId;
}

// 拒付付款修改
function updateFKJF(el) {
    var rowIndex = el.parentElement.parentElement.rowIndex;
    var WorkItemId = $.MvcSheetUI.GetControlValue('FKJFRecordTbl.WorkItemId', rowIndex - 1);
    window.location.href = "/Portal/Sheets/Contract/FKMy.aspx?Mode=Work&WorkItemID=" + WorkItemId;
}


// 结算查看
function viewJS(el) {
    var rowIndex = el.parentElement.parentElement.rowIndex;
    var WorkItemId = $.MvcSheetUI.GetControlValue('JSRecordTbl.WorkItemId', rowIndex - 1);
    window.location.href = "/Portal/Sheets/Contract/JSMy.aspx?Mode=View&WorkItemID=" + WorkItemId;
}

// 结算修改
function updateJS(el) {
    var rowIndex = el.parentElement.parentElement.rowIndex;
    var WorkItemId = $.MvcSheetUI.GetControlValue('JSRecordTbl.WorkItemId', rowIndex - 1);
    window.location.href = "/Portal/Sheets/Contract/JSMy.aspx?Mode=Work&WorkItemID=" + WorkItemId;
}

// 结算中进行请款申请
function updateJSQK(el) {
    var ContractNo = $.MvcSheetUI.GetControlValue("ContractNo");
    var WorkflowVersion_QK = $.MvcSheetUI.GetControlValue("WorkflowVersion_QK");
    var rowIndex = el.parentElement.parentElement.rowIndex;
    var JSObjectID = $.MvcSheetUI.GetControlValue('JSRecordTbl.JSObjectID', rowIndex - 1);
    var JSResultNum = $.MvcSheetUI.GetControlValue('JSRecordTbl.JSResultNum', rowIndex - 1);
    window.location.href = "/Portal/Sheets/Contract/QKMy.aspx?Mode=Originate&WorkflowCode=QK&WorkflowVersion=" + WorkflowVersion_QK + "&ContractNo=" + ContractNo + "&QKType=JS&JSObjectID=" + JSObjectID + "&JSResultNum=" + JSResultNum;
}

// 结算中进行付款申请
function updateJSFK(el) {
    var ContractNo = $.MvcSheetUI.GetControlValue("ContractNo");
    var WorkflowVersion_FK = $.MvcSheetUI.GetControlValue("WorkflowVersion_FK");
    var rowIndex = el.parentElement.parentElement.rowIndex;
    var JSObjectID = $.MvcSheetUI.GetControlValue('JSRecordTbl.JSObjectID', rowIndex - 1);
    var JSResultNum = $.MvcSheetUI.GetControlValue('JSRecordTbl.JSResultNum', rowIndex - 1);
    window.location.href = "/Portal/Sheets/Contract/FKMy.aspx?Mode=Originate&WorkflowCode=FK&WorkflowVersion=" + WorkflowVersion_FK + "&ContractNo=" + ContractNo + "&FKType=ZKType_JS&JSObjectID=" + JSObjectID + "&JSResultNum=" + JSResultNum ;
}


function undocancelImportLicence(el) {
    var rowIndex = el.parentElement.parentElement.rowIndex;
    var ImportLicenseId = $.MvcSheetUI.GetControlValue('ImportLicenceTbl.ImportLicenseId', rowIndex - 1);
    $.ajax({
        type: "POST",    //页面请求的类型
        url: "ContractHandler.ashx?Command=cancelImportLicence",   //处理页的相对地址
        data: {
            ImportLicenseId: ImportLicenseId,
            flg: "undocancel",
        },
        async: false,
        success: function (ret) {    //这是处理后执行的函数，msg是处理页返回的数据
            var rowp = 1;
            $("[data-datafield='ImportLicenceTbl']").find("tr.rows").each(function () {
                if (rowp == rowIndex - 1) {
                    $(this).find("td[data-field='ImportLicenceTbl.Operate'] a.cancelImportLicence").show();
                    $(this).find("td[data-field='ImportLicenceTbl.Operate'] a.undocancelImportLicence").hide();
                    $(this).find("td[data-field='ImportLicenceTbl.DisplayName']").text("已办证");
                }
                rowp++;
            });
        }
    });
}

/*
    子表删除行事件
    参数：row -> 被删除的行
*/
var rowPreRemoved = function (row) {
    var rownum = row.attr("data-row");
    var ContactName = $.MvcSheetUI.GetControlValue("SalerTbl.ContactName", rownum);
    var Salers = $.MvcSheetUI.GetControlValue('Salers');
    $.MvcSheetUI.SetControlValue('Salers', Salers.replace(ContactName + ",",''))
}

// 增加自定义工具栏按钮方法，触发后台事件
$.MvcSheet.AddAction({
    //Action: "GetBackAction",       // 执行后台方法名称
    Icon: "fa-sign-in",           // 按钮图标
    Text: "取回",           // 按钮名称
    Datas: [],    // 参数，多个参数 "{Param1}","Param2"...
    OnAction: function () {
        /*
        自定义按钮执行事件，如果为 null 则调用$.MvcSheet.Action 执行后台方法
        如果不为 null，那么会执行这里的方法，需要自己Post到后台或写前端逻辑
        */
        $.ajax({
            type: "POST",    //页面请求的类型
            url: "/Portal/InstanceDetail/GetAdjustActivityInfo",   //处理页的相对地址
            data: {
                InstanceID: $.MvcSheetUI.SheetInfo.InstanceId,
            },
            success: function (ret) {    //这是处理后执行的函数，msg是处理页返回的数据
                var options = "";
                if (ret.SUCCESS == true) {
                    console.log("GetAdjustActivityInfo=" + ret);
                    for (var i = 0; i < ret.InstanceActivity.length; i++) {
                        if ($.MvcSheetUI.SheetInfo.ActivityCode == "ActivityApprove") {
                            if (ret.InstanceActivity[i].ActivityName == "创建合同") {
                                options += '<option value="' + ret.InstanceActivity[i].ActivityCode + '">' + ret.InstanceActivity[i].ActivityName + '</option>';
                            }
                        }
                        if ($.MvcSheetUI.SheetInfo.ActivityCode == "ActivityOperate") {
                            if (ret.InstanceActivity[i].ActivityName == "创建合同") {
                                options += '<option value="' + ret.InstanceActivity[i].ActivityCode + '">' + ret.InstanceActivity[i].ActivityName + '</option>';
                            }
                            if (ret.InstanceActivity[i].ActivityName == "合同审签") {
                                options += '<option value="' + ret.InstanceActivity[i].ActivityCode + '">' + ret.InstanceActivity[i].ActivityName + '</option>';
                            }
                        }
                        if ($.MvcSheetUI.GetControlValue('IsComplete') == "True") {
                            if (ret.InstanceActivity[i].ActivityName == "创建合同") {
                                options += '<option value="' + ret.InstanceActivity[i].ActivityCode + '">' + ret.InstanceActivity[i].ActivityName + '</option>';
                            }
                            if (ret.InstanceActivity[i].ActivityName == "合同审签") {
                                options += '<option value="' + ret.InstanceActivity[i].ActivityCode + '">' + ret.InstanceActivity[i].ActivityName + '</option>';
                            }
                            if (ret.InstanceActivity[i].ActivityName == "合同执行") {
                                options += '<option value="' + ret.InstanceActivity[i].ActivityCode + '">' + ret.InstanceActivity[i].ActivityName + '</option>';
                            }
                        }
                        
                    }
                }
                //让弹出框显示的操作方法
                $('#message-module').find('.modal-body').html(
                    '<div style="text-align: center;padding: 50px;line-height: 25px">' +
                    '<form class="bs-example form-horizontal" name="form" >' +
                    '<div class="row">' +
                    '    <h5 class="col-md-4" style="padding-top: 14px;">选择活动: </h5><div class="col-md-6 input-group">' +
                    '        <select class="form-control" id="ActivityCodes" ><option value="">请选择</option>' + options +
                    '                 </select > ' +
                    '    </div>' +
                    '</div > ' +
                    '</form > ' +
                    '</div > '
                );
                var moduleFooter = $('#message-module').find('.modal-footer');
                var cancleButton = $('<button type="button" class="btn " data-dismiss="modal" style=" border-radius: 0px;border: 0px;margin-left: 0px;width: 50%;background-color:white;float: left;border-bottom-left-radius: 5px;border-color: #ff993b;line-height: 25px;color:black">取消</button>');
                var confirmButton = $('<button type="button" class="btn btn-default" style="border-radius: 0px;border: 0px;background-color: #FF993B;width: 50%;float: right;border-bottom-right-radius: 6px;line-height: 25px;margin-left: 0px;">确定</button>');

                if (moduleFooter.find('button').length === 0) {
                    cancleButton.appendTo(moduleFooter);
                    confirmButton.appendTo(moduleFooter);
                }
                $('#message-module').modal({ keyboard: true, show: true, backdrop: true });
                $('#message-module').on('shown.bs.modal', function () {
                    $.LoadingMask.Hide();
                });
                confirmButton.click(function () {
                    $.MvcSheetUI.SetControlValue("NeedActivityCode", $("#ActivityCodes").val());
                    $.MvcSheetUI.SetControlValue("NeedActivityName", $("#ActivityCodes").find("option:selected").text());
                    $.MvcSheetUI.SetControlValue("GetBackFlg", "1");
                    $('#message-module').modal('hide');
                    //doGoBack($("#ActivityCodes").val());
                    GotoBackPage();
                    
                });
            }
        });
    },
    //OnActionDone: function (ret) {

    
    //},
    PostSheetInfo: true         // 是否提交表单数据，如果 false，那么不返回表单的数据
});

// 增加终止按钮方法，触发后台事件
$.MvcSheet.AddAction({
    Icon: "fa-sign-in",           // 按钮图标
    Text: "终止",           // 按钮名称
    Datas: [],    // 参数，多个参数 "{Param1}","Param2"...
    OnAction: function () {
        //让弹出框显示的操作方法
        $('#message-module').find('.modal-body').html(
            '<div style="text-align: center;padding: 50px;line-height: 25px">' +
            '确定终止合同吗？' +
            '</div > '
        );
        var moduleFooter = $('#message-module').find('.modal-footer');
        var cancleButton = $('<button type="button" class="btn " data-dismiss="modal" style=" border-radius: 0px;border: 0px;margin-left: 0px;width: 50%;background-color:white;float: left;border-bottom-left-radius: 5px;border-color: #ff993b;line-height: 25px;color:black">取消</button>');
        var confirmButton = $('<button type="button" class="btn btn-default" style="border-radius: 0px;border: 0px;background-color: #FF993B;width: 50%;float: right;border-bottom-right-radius: 6px;line-height: 25px;margin-left: 0px;">确定</button>');

        if (moduleFooter.find('button').length === 0) {
            cancleButton.appendTo(moduleFooter);
            confirmButton.appendTo(moduleFooter);
        }
        $('#message-module').modal({ keyboard: true, show: true, backdrop: true });
        $('#message-module').on('shown.bs.modal', function () {
            $.LoadingMask.Hide();
        });
        confirmButton.click(function () {
            $('#message-module').modal('hide');
            GotoCancelPage();

        });

    },
    //OnActionDone: function (ret) {


    //},
    PostSheetInfo: true         // 是否提交表单数据，如果 false，那么不返回表单的数据
});

function GotoBackPage() {
    var WorkflowVersion_Back = $.MvcSheetUI.GetControlValue("WorkflowVersion_Back");
    var InstanceActivity = $("#ActivityCodes").val();
    var InstanceId = $.MvcSheetUI.SheetInfo.InstanceId;
    var InstanceName = "";
    $.ajax({
        type: "POST",    //页面请求的类型
        url: "ContractHandler.ashx?Command=getInstanceById",   //处理页的相对地址
        data: {
            InstanceId: InstanceId,
        },
        async: false,
        success: function (ret) {    //这是处理后执行的函数，msg是处理页返回的数据
            if (ret.InstanceName != undefined) {
                InstanceName = ret.InstanceName;
            }
        }
    });
    if (InstanceName == "") {
        alert("合同流程还未发起，请先发起！");
        return false;
    }
    var ContractNo = $.MvcSheetUI.GetControlValue("ContractNo");
    if (InstanceActivity != "") {
        window.location.href = "/Portal/Sheets/Contract/GetBackMy.aspx?Mode=Originate&WorkflowCode=GetBackContract&WorkflowVersion=" + WorkflowVersion_Back + "&InstanceId=" + InstanceId + "&InstanceActivity=" + InstanceActivity + "&ContractNo=" + ContractNo;
    } else {
        alert("请选择取回的节点！");
        return false;
    }
}


function GotoCancelPage() {
    var WorkflowVersion_Cancel = $.MvcSheetUI.GetControlValue("WorkflowVersion_Cancel");
    var InstanceId = $.MvcSheetUI.SheetInfo.InstanceId;
    var ContractNo = $.MvcSheetUI.GetControlValue("ContractNo");
    var InstanceName = "";
    $.ajax({
        type: "POST",    //页面请求的类型
        url: "ContractHandler.ashx?Command=getInstanceById",   //处理页的相对地址
        data: {
            InstanceId: InstanceId,
        },
        async: false,
        success: function (ret) {    //这是处理后执行的函数，msg是处理页返回的数据
            if (ret.InstanceName != undefined) {
                InstanceName = ret.InstanceName;
            }
        }
    });
    if (InstanceName == "") {
        alert("合同流程还未发起，请先发起！");
        return false;
    }
    window.location.href = "/Portal/Sheets/Contract/CancelMy.aspx?Mode=Originate&WorkflowCode=Cancel&WorkflowVersion=" + WorkflowVersion_Cancel + "&InstanceId=" + InstanceId + "&ContractNo=" + ContractNo;

}

function AgencyTypeChange() {
    if ($("select[data-datafield='AgencyType']").children('option:selected').val() == 'NotNeed') {
        $('.AgencyFile').hide();
        $('.AgencySelect').hide();
        $('.AgencyAfterRemark').hide();
        $('.AgencyComment').hide();
    } else if ($("select[data-datafield='AgencyType']").children('option:selected').val() == 'Approved') {
        if ($.MvcSheetUI.GetControlValue('ContractProperty') == 'ContractProperty_HKMY') {
            $('.AgencyFile').show();
            $('.AgencySelect').hide();
        } else {
            $('.AgencyFile').hide();
            $('.AgencySelect').show();
        }
        $('.AgencyAfterRemark').hide();
        $('.AgencyComment').show();
    } else if ($("select[data-datafield='AgencyType']").children('option:selected').val() == 'AfterApprove') {
        $('.AgencyFile').hide();
        $('.AgencySelect').hide();
        $('.AgencyAfterRemark').show();
        $('.AgencyComment').hide();
    }
}

function AgencySelectChange() {
    // 代理协议返回类型为01 （固定值）
    if ($.MvcSheetUI.GetControlValue('AgencyReturnType') == 'AgencyRate_RMB') {
        $.MvcSheetUI.SetControlValue('AgencyComment', "代理费计算：固定金额");
    } else if ($.MvcSheetUI.GetControlValue('AgencyReturnType') == 'AgencyRate_Percent') {
        $.MvcSheetUI.SetControlValue('AgencyComment', "代理费计算：按合同价＊费率");
    }
}

function compRMBAmount() {
    // 合同金额(人民币合同） + 总金额（外币） * 签约日汇率
    var ContractTotalPrice = $.MvcSheetUI.GetControlValue('ContractTotalPrice');
    var JKTotalAmount = $.MvcSheetUI.GetControlValue('JKTotalAmount');
    var SignDayExchangeRate = $.MvcSheetUI.GetControlValue('SignDayExchangeRate');
    $.MvcSheetUI.SetControlValue('RMBTotalAmount', (parseFloat(ContractTotalPrice) + parseFloat(JKTotalAmount) * parseFloat(SignDayExchangeRate)).toFixed(2));
}

function ContractTypeChange() {
    if ($("select[data-datafield='ContractType']").children('option:selected').val() == 'GN') {
        //当为国内合同时禁用按钮
        var List = $('.nav-tabs li').find('a');
        for(var i=0;i<List.length;i++){
            if($(List[i]).html() =='信用证' || $(List[i]).html() =='进口许可证' || $(List[i]).html() =='到货'){
                $(List[i]).removeAttr('href');
                $(List[i]).addClass('disableBtn');
            }
        }
        $('.CountryTitle').hide();
        $('.CountrySelect').hide();
    } else {
        //进口合同时恢复
        var List = $('.nav-tabs li').find('a');
        for(var i=0;i<List.length;i++){
            if($(List[i]).html() =='信用证'){
                $(List[i]).attr('href','#xyztab');
                $(List[i]).removeClass('disableBtn');
            }else if($(List[i]).html() =='进口许可证'){
                $(List[i]).attr('href','#importlicensetab');
                $(List[i]).removeClass('disableBtn');
            }else if($(List[i]).html() =='到货'){
                $(List[i]).attr('href','#dhtab');
                $(List[i]).removeClass('disableBtn');
            }
        }
        $('.CountryTitle').show();
        $('.CountrySelect').show();
    }
}

function BidTypeChange() {
    var BidType = $.MvcSheetUI.GetControlValue('BidType');
    if (BidType == '0') {
        $.MvcSheetUI.SetControlValue('BidNo', '');
        $('.BidNo').hide();
        var dtl = $.MvcSheetUI.GetElement("BidTbl").SheetGridView();
        dtl._Clear();
    } else {
        $('.BidNo').show();
    }
}

function computePayManager() {
    var objDk = document.getElementById("selectDk");
    var dk_num = 0.0;
    for (var i = 0; i < objDk.options.length; i++) {
        if (objDk.options[i].selected) {
            if (objDk.options[i].innerHTML.indexOf("人民币") >= 0 ) {
                var amount = objDk.options[i].innerHTML.split("人民币")[0];
                dk_num += parseFloat(amount);
            }
        }
    }
    var objFk = document.getElementById("selectFk");
    var fk_num = 0.0;
    for (var i = 0; i < objFk.options.length; i++) {
        if (objFk.options[i].selected) {
            if (objFk.options[i].innerHTML.indexOf("人民币") >= 0) {
                var amount = objFk.options[i].innerHTML.split("人民币")[0];
                fk_num += parseFloat(amount);
            }
        }
    }
    var dif = dk_num - fk_num;
    var djsje = "";
    if (dif == 0) {
        djsje = 0;
    } else if (dif > 0) {
        djsje = "应退" + dif;
    } else if (dif < 0) {
        djsje = "应收" + dif*(-1);
    }
    $('#selectDjsje').val(djsje);
    
}